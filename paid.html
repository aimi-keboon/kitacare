<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Successful | kitacare</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background-color: var(--bg-light); text-align: center; padding-top: 50px; }
        .success-card { max-width: 600px; margin: 0 auto; background: white; padding: 40px; border: 2px solid var(--brand-black); box-shadow: 10px 10px 0px var(--brand-black); }
        .icon-circle { width: 80px; height: 80px; background: var(--brand-blue); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 20px; }
        .policy-box { background: #fff4f4; border-left: 4px solid #d9534f; padding: 20px; text-align: left; margin: 25px 0; font-size: 0.9rem; }
        .status-msg { font-weight: bold; color: var(--brand-blue); margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="success-card">
        <div class="icon-circle">âœ“</div>
        <h1>Payment Successful!</h1>
        <p class="status-msg" id="update-status">Finalizing your booking details...</p>

        <p>Thank you for choosing <strong>kitacare</strong>. Your deposit has been received successfully.</p>

        <div class="policy-box">
            <strong>Deposit Policy:</strong><br>
            All bookings require a deposit. Once the booking is approved, the deposit is <strong>non-refundable</strong>. The deposit will only be refunded in the event that the booking is cancelled by <strong>KitaCare</strong>.
        </div>

        <p>Our team will be in touch with you <strong>ASAP</strong> via WhatsApp or Email to confirm your caretaker details.</p>

        <a href="dashboard.html" class="btn-primary" style="display:block; text-decoration:none; margin-top:30px;">GO TO DASHBOARD</a>
    </div>

    <script src="config.js"></script>
    <script>
        async function updateStatus() {
            const userEmail = localStorage.getItem("userEmail");
            
            if (!userEmail) return;

            try {
                // We send a request to the backend to find the LATEST booking for this email
                // and update its status from "Paid - Pending" to "Paid"
                await fetch(APPS_SCRIPT_URL, {
                    method: "POST",
                    body: JSON.stringify({
                        action: "confirm_payment",
                        email: userEmail
                    })
                });
                document.getElementById('update-status').innerText = "Booking Status: Paid & Confirmed";
            } catch (e) {
                console.log("Status update delayed, but payment is recorded in Stripe.");
            }
        }

        window.onload = updateStatus;
    </script>
</body>
</html>