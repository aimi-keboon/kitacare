<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access | kitacare</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Modern Mobile-First Fixes */
        body { background-color: var(--bg-light); margin: 0; }
        
        .auth-wrapper { 
            min-height: calc(100vh - 80px); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; /* Reduced padding for mobile */
        }

        .auth-card { 
            width: 100%; 
            max-width: 450px; 
            background: white; 
            border: 2px solid var(--brand-black); 
            padding: 30px 20px; /* Tighter padding on mobile */
            box-shadow: 8px 8px 0px var(--brand-black); /* Slightly smaller shadow for small screens */
            box-sizing: border-box;
        }

        /* Mobile specific adjustments */
        @media (max-width: 480px) {
            .auth-card {
                padding: 20px 15px;
                box-shadow: 5px 5px 0px var(--brand-black); /* Minimal shadow on very small phones */
            }
            header img {
                height: 30px; /* Smaller logo for mobile headers */
            }
            .grid-mobile-stack {
                grid-template-columns: 1fr !important; /* Stack DOB and Gender on mobile */
                gap: 0 !important;
            }
        }

        .tabs { display: flex; margin-bottom: 25px; border-bottom: 2px solid var(--border-gray); }
        .tab { 
            flex: 1; 
            padding: 15px 10px; 
            text-align: center; 
            cursor: pointer; 
            font-weight: 800; 
            text-transform: uppercase; 
            font-size: 0.8rem; 
            color: var(--text-muted); 
            transition: 0.2s;
        }
        .tab.active { color: var(--brand-blue); border-bottom: 4px solid var(--brand-blue); }
        
        /* Form Styling */
        .input-group { margin-bottom: 18px; }
        .input-group label { display: block; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; margin-bottom: 6px; }
        
        /* Larger touch targets for mobile inputs */
        input, select, textarea {
            width: 100%;
            padding: 12px; 
            font-size: 16px !important; /* Prevents iOS auto-zoom on focus */
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .hidden { display: none; }
        .btn-primary { 
            width: 100%; 
            padding: 15px; 
            font-weight: 800; 
            letter-spacing: 1px; 
            cursor: pointer;
        }
        .loading { opacity: 0.7; pointer-events: none; cursor: wait; }
    </style>
</head>
<body>

    <header style="padding: 15px 20px; border-bottom: 1px solid #eee; background: white;">
        <a href="index.html" class="logo-link">
            <img src="kitacare.png" alt="kitacare" style="height: 35px;">
        </a>
    </header>

    <div class="auth-wrapper">
        <div class="auth-card">
            <div class="tabs">
                <div class="tab active" id="l-tab" onclick="switchTab('login')">Login</div>
                <div class="tab" id="s-tab" onclick="switchTab('signup')">Signup</div>
            </div>

            <form id="login-form">
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="email" id="l-email" placeholder="email@example.com" required>
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="l-pass" placeholder="••••••••" required>
                </div>
                <button type="button" class="btn-primary" id="login-btn" onclick="handleLogin()">LOGIN</button>
            </form>

            <form id="signup-form" class="hidden">
                <div class="input-group">
                    <label>Register As</label>
                    <select id="s-role" required>
                        <option value="Client">Client (Seeking Care)</option>
                        <option value="Caregiver">Caregiver</option>
                        <option value="Professional">Professional (Nurse/Doctor)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Full Name</label>
                    <input type="text" id="s-name" placeholder="Full Name" required>
                </div>
                <div class="grid-mobile-stack" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="input-group">
                        <label>Date of Birth</label>
                        <input type="date" id="s-dob" required>
                    </div>
                    <div class="input-group">
                        <label>Gender</label>
                        <select id="s-gender" required>
                            <option>Male</option>
                            <option>Female</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="email" id="s-email" placeholder="name@email.com" required>
                </div>
                <div class="input-group">
                    <label>Contact Number</label>
                    <input type="tel" id="s-phone" placeholder="+60..." required>
                </div>
                <div class="input-group">
                    <label>Create Password</label>
                    <input type="password" id="s-pass" placeholder="min 8 chars" required>
                </div>
                <button type="button" class="btn-primary" id="signup-btn" onclick="handleSignup()">CREATE ACCOUNT</button>
            </form>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        function switchTab(view) {
            document.getElementById('login-form').classList.toggle('hidden', view !== 'login');
            document.getElementById('signup-form').classList.toggle('hidden', view !== 'signup');
            document.getElementById('l-tab').classList.toggle('active', view === 'login');
            document.getElementById('s-tab').classList.toggle('active', view === 'signup');
            window.scrollTo(0, 0); // Reset scroll position when switching tabs
        }

        async function handleSignup() {
            const btn = document.getElementById('signup-btn');
            const data = {
                action: "signup",
                role: document.getElementById('s-role').value,
                name: document.getElementById('s-name').value,
                dob: document.getElementById('s-dob').value,
                gender: document.getElementById('s-gender').value,
                email: document.getElementById('s-email').value.toLowerCase().trim(),
                phone: document.getElementById('s-phone').value,
                password: document.getElementById('s-pass').value
            };

            if (!data.email || !data.password || !data.name) return alert("Please fill in all fields.");
            
            btn.innerText = "CREATING...";
            btn.classList.add('loading');

            try {
                const response = await fetch(APPS_SCRIPT_URL, { method: "POST", body: JSON.stringify(data) });
                const result = await response.json();
                if (result.status === "success") {
                    alert("Account created! Logging you in...");
                    switchTab('login');
                } else {
                    alert(result.message);
                }
            } catch (e) { 
                alert("Signup error."); 
            } finally {
                btn.innerText = "CREATE ACCOUNT";
                btn.classList.remove('loading');
            }
        }

        async function handleLogin() {
            const btn = document.getElementById('login-btn');
            const email = document.getElementById('l-email').value.toLowerCase().trim();
            const password = document.getElementById('l-pass').value;

            if (!email || !password) return alert("Please enter credentials.");
            
            btn.innerText = "WAIT...";
            btn.classList.add('loading');

            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: "POST",
                    body: JSON.stringify({ action: "login", email, password })
                });
                const result = await response.json();

                if (result.status === "success") {
                    localStorage.setItem("userData", JSON.stringify(result.user));
                    localStorage.setItem("userEmail", result.user.email);
                    localStorage.setItem("userName", result.user.name);

                    if (result.user.role === "Client") {
                        window.location.href = "dashboard.html";
                    } else {
                        window.location.href = "professionals.html";
                    }
                } else {
                    alert(result.message);
                }
            } catch (e) { 
                alert("Login connection error."); 
            } finally {
                btn.innerText = "LOGIN";
                btn.classList.remove('loading');
            }
        }
    </script>
</body>
</html>