<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access | kitacare</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Modern Mobile-First Fixes */
        :root { --brand-blue: #007bff; --brand-black: #000000; --bg-light: #f8f9fa; }
        body { background-color: var(--bg-light); margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        /* MATCHED HEADER FROM INDEX */
        header { 
            padding: 0 5%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            height: 100px; /* Matched to index */
            background: white;
            border-bottom: 1px solid #eee;
            box-sizing: border-box;
        }
        header img { 
            height: 45px; /* Matched large logo size */
            display: block;
        }

        .auth-wrapper { 
            min-height: calc(100vh - 100px); /* Adjusted for 100px header */
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
            box-sizing: border-box;
        }

        .auth-card { 
            width: 100%; 
            max-width: 450px; 
            background: white; 
            border: 2px solid var(--brand-black); 
            padding: 30px 20px; 
            box-shadow: 12px 12px 0px var(--brand-black); /* Matched shadow depth */
            box-sizing: border-box;
        }

        /* --- INPUT NORMALIZATION FIX --- */
        input, select, textarea {
            width: 100%;
            height: 48px; 
            padding: 10px 12px; 
            font-size: 16px !important; 
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            display: block;
            background-color: #fff;
            font-family: inherit;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        input[type="date"] { min-height: 48px; line-height: 1.2; background-color: #fff; }

        select {
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px auto;
            padding-right: 35px;
            cursor: pointer;
        }

        .tabs { display: flex; margin-bottom: 25px; border-bottom: 2px solid #eee; }
        .tab { 
            flex: 1; 
            padding: 15px 10px; 
            text-align: center; 
            cursor: pointer; 
            font-weight: 800; 
            text-transform: uppercase; 
            font-size: 0.8rem; 
            color: #999; 
            transition: 0.2s;
        }
        .tab.active { color: var(--brand-blue); border-bottom: 4px solid var(--brand-blue); }
        
        .input-group { margin-bottom: 18px; }
        .input-group label { display: block; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; margin-bottom: 6px; }
        
        .hidden { display: none; }
        .btn-primary { 
            width: 100%; 
            padding: 15px; 
            font-weight: 800; 
            letter-spacing: 1px; 
            cursor: pointer;
            background: var(--brand-black);
            color: white;
            border: none;
            transition: background 0.3s;
        }
        .btn-primary:hover { background: var(--brand-blue); }
        .loading { opacity: 0.7; pointer-events: none; cursor: wait; }

        .btn-outline {
            text-decoration: none;
            color: var(--brand-black);
            border: 2px solid var(--brand-black);
            padding: 10px 28px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        @media (max-width: 480px) {
            header { height: 80px; }
            header img { height: 35px; }
            .auth-card { box-shadow: 8px 8px 0px var(--brand-black); }
        }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="logo-link">
            <img src="kitacare.png" alt="kitacare">
        </a>
        <nav><a href="index.html" class="btn-outline">HOME</a></nav>
    </header>

    <div class="auth-wrapper">
        <div class="auth-card">
            <div class="tabs">
                <div class="tab active" id="l-tab" onclick="switchTab('login')">Login</div>
                <div class="tab" id="s-tab" onclick="switchTab('signup')">Signup</div>
            </div>

            <form id="login-form">
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="email" id="l-email" placeholder="email@example.com" required>
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="l-pass" placeholder="••••••••" required>
                </div>
                <button type="button" class="btn-primary" id="login-btn" onclick="handleLogin()">LOGIN</button>
            </form>

            <form id="signup-form" class="hidden">
                <div class="input-group">
                    <label>Register As</label>
                    <select id="s-role" required>
                        <option value="Client">Client (Seeking Care)</option>
                        <option value="Caregiver">Caregiver</option>
                        <option value="Professional">Professional (Nurse/Doctor)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Full Name</label>
                    <input type="text" id="s-name" placeholder="Full Name" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="input-group">
                        <label>Date of Birth</label>
                        <input type="date" id="s-dob" required>
                    </div>
                    <div class="input-group">
                        <label>Gender</label>
                        <select id="s-gender" required>
                            <option>Male</option>
                            <option>Female</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="email" id="s-email" placeholder="name@email.com" required>
                </div>
                <div class="input-group">
                    <label>Contact Number</label>
                    <input type="tel" id="s-phone" placeholder="+60..." required>
                </div>
                <div class="input-group">
                    <label>Create Password</label>
                    <input type="password" id="s-pass" placeholder="min 8 chars" required>
                </div>
                <button type="button" class="btn-primary" id="signup-btn" onclick="handleSignup()">CREATE ACCOUNT</button>
            </form>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        function switchTab(view) {
            document.getElementById('login-form').classList.toggle('hidden', view !== 'login');
            document.getElementById('signup-form').classList.toggle('hidden', view !== 'signup');
            document.getElementById('l-tab').classList.toggle('active', view === 'login');
            document.getElementById('s-tab').classList.toggle('active', view === 'signup');
        }

        async function handleSignup() {
            const btn = document.getElementById('signup-btn');
            const data = {
                action: "signup",
                role: document.getElementById('s-role').value,
                name: document.getElementById('s-name').value,
                dob: document.getElementById('s-dob').value,
                gender: document.getElementById('s-gender').value,
                email: document.getElementById('s-email').value.toLowerCase().trim(),
                phone: document.getElementById('s-phone').value,
                password: document.getElementById('s-pass').value
            };

            if (!data.email || !data.password || !data.name) return alert("Please fill in all fields.");
            
            btn.innerText = "SENDING VERIFICATION...";
            btn.classList.add('loading');

            try {
                const response = await fetch(APPS_SCRIPT_URL, { 
                    method: "POST", 
                    body: JSON.stringify(data) 
                });
                const result = await response.json();
                
                if (result.status === "success") {
                    alert("Verification link sent!\n\nPlease check your email inbox to activate your account.");
                    switchTab('login');
                } else {
                    alert(result.message);
                }
            } catch (e) { 
                alert("Signup error."); 
            } finally {
                btn.innerText = "CREATE ACCOUNT";
                btn.classList.remove('loading');
            }
        }

        async function handleLogin() {
            const btn = document.getElementById('login-btn');
            const email = document.getElementById('l-email').value.toLowerCase().trim();
            const password = document.getElementById('l-pass').value;

            if (!email || !password) return alert("Please enter credentials.");
            
            btn.innerText = "VERIFYING...";
            btn.classList.add('loading');

            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: "POST",
                    body: JSON.stringify({ action: "login", email, password })
                });
                const result = await response.json();

                if (result.status === "success") {
                    localStorage.setItem("userData", JSON.stringify(result.user));
                    localStorage.setItem("userEmail", result.user.email);
                    localStorage.setItem("userName", result.user.name);
                    window.location.href = result.user.role === "Client" ? "dashboard.html" : "professionals.html";
                } else {
                    alert(result.message);
                }
            } catch (e) { 
                alert("Login connection error."); 
            } finally {
                btn.innerText = "LOGIN";
                btn.classList.remove('loading');
            }
        }
    </script>
</body>
</html>